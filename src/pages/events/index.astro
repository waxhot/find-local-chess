---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';

// Get all events and sort by date
const allEvents = await getCollection('events');
const sortedEvents = allEvents.sort((a, b) => a.data.date.getTime() - b.data.date.getTime());

const upcomingEvents = sortedEvents.filter(event => event.data.date >= new Date());
const pastEvents = sortedEvents.filter(event => event.data.date < new Date());
---

<BaseLayout title="Chess Events - Find Local Chess">
  <h1>Chess Events</h1>
  
  <p>Find all chess events, tournaments, and meetups near you.</p>

  {upcomingEvents.length > 0 && (
    <section>
      <h2>Upcoming Events</h2>
      <div class="events-list">
        {upcomingEvents.map((event) => (
          <article class="event-item">
            <div class="event-date">
              <div class="month">{event.data.date.toLocaleDateString('en-US', { month: 'short' })}</div>
              <div class="day">{event.data.date.getDate()}</div>
            </div>
            <div class="event-content">
              <h3>
                <a href={`/events/${event.slug}`}>{event.data.title}</a>
              </h3>
              <div class="event-details">
                <span>ğŸ• {event.data.time}</span>
                <span>ğŸ“ {event.data.location}</span>
                {event.data.entryFee && <span>ğŸ’° {event.data.entryFee}</span>}
              </div>
              <p>{event.data.description}</p>
              <div class="event-tags">
                {event.data.tags.map(tag => (
                  <span class="tag">{tag}</span>
                ))}
              </div>
            </div>
          </article>
        ))}
      </div>
    </section>
  )}

  {pastEvents.length > 0 && (
    <section>
      <h2>Past Events</h2>
      <div class="events-list">
        {pastEvents.reverse().map((event) => (
          <article class="event-item past-event">
            <div class="event-date">
              <div class="month">{event.data.date.toLocaleDateString('en-US', { month: 'short' })}</div>
              <div class="day">{event.data.date.getDate()}</div>
            </div>
            <div class="event-content">
              <h3>
                <a href={`/events/${event.slug}`}>{event.data.title}</a>
              </h3>
              <div class="event-details">
                <span>ğŸ• {event.data.time}</span>
                <span>ğŸ“ {event.data.location}</span>
                {event.data.entryFee && <span>ğŸ’° {event.data.entryFee}</span>}
              </div>
              <p>{event.data.description}</p>
              <div class="event-tags">
                {event.data.tags.map(tag => (
                  <span class="tag">{tag}</span>
                ))}
              </div>
            </div>
          </article>
        ))}
      </div>
    </section>
  )}

  {allEvents.length === 0 && (
    <p>No events found. <a href="/contribute">Add the first event!</a></p>
  )}
</BaseLayout>

<style>
  .events-list {
    display: flex;
    flex-direction: column;
    gap: 2rem;
    margin: 2rem 0;
  }
  
  .event-item {
    display: flex;
    background: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 8px;
    padding: 1.5rem;
    transition: box-shadow 0.2s;
  }
  
  .event-item:hover {
    box-shadow: 0 4px 8px rgba(0,0,0,0.15);
  }
  
  .past-event {
    opacity: 0.7;
  }
  
  .event-date {
    background: #2c3e50;
    color: white;
    border-radius: 8px;
    padding: 1rem;
    text-align: center;
    margin-right: 1.5rem;
    min-width: 80px;
    height: fit-content;
  }
  
  .event-date .month {
    font-size: 0.875rem;
    font-weight: 500;
    text-transform: uppercase;
  }
  
  .event-date .day {
    font-size: 1.5rem;
    font-weight: bold;
    margin-top: 0.25rem;
  }
  
  .event-content {
    flex: 1;
  }
  
  .event-content h3 {
    margin-top: 0;
    margin-bottom: 1rem;
  }
  
  .event-content h3 a {
    text-decoration: none;
    color: #2c3e50;
  }
  
  .event-content h3 a:hover {
    text-decoration: underline;
  }
  
  .event-details {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    margin-bottom: 1rem;
    font-size: 0.875rem;
    color: #666;
  }
  
  .event-tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-top: 1rem;
  }
  
  .tag {
    background: #007bff;
    color: white;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    font-size: 0.75rem;
  }
  
  section {
    margin: 3rem 0;
  }
  
  @media (max-width: 768px) {
    .event-item {
      flex-direction: column;
    }
    
    .event-date {
      margin-right: 0;
      margin-bottom: 1rem;
      width: fit-content;
    }
  }
</style>
